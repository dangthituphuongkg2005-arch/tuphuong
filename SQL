CREATE DATABASE QLSV
GO
USE QLSV
GO
-- Đảm bảo không có bảng cũ tồn tại để tránh lỗi
IF OBJECT_ID('Student', 'U') IS NOT NULL DROP TABLE Student;
IF OBJECT_ID('Major', 'U') IS NOT NULL DROP TABLE Major;
IF OBJECT_ID('Faculty', 'U') IS NOT NULL DROP TABLE Faculty;
GO

-- 1. Tạo bảng Faculty (Khoa)
-- Khóa chính: FacultyID
CREATE TABLE Faculty (
    FacultyID INT PRIMARY KEY,
    FacultyName NVARCHAR(255) NOT NULL
);
GO

-- 2. Tạo bảng Major (Chuyên ngành)
-- Khóa chính là Khóa ghép (FacultyID, MajorID)
CREATE TABLE Major (
    FacultyID INT NOT NULL,
    MajorID INT NOT NULL,
    Name NVARCHAR(255) NOT NULL,
    
    -- Định nghĩa khóa chính là sự kết hợp của hai cột
    PRIMARY KEY (FacultyID, MajorID), 
    
    FOREIGN KEY (FacultyID) REFERENCES Faculty(FacultyID)
);
GO

-- 3. Tạo bảng Student (Sinh viên)
CREATE TABLE Student (
    StudentID NVARCHAR(20) PRIMARY KEY,
    FullName NVARCHAR(255) NOT NULL,
    AverageScore FLOAT NOT NULL,
    
    -- Cột Khóa ngoại PHẢI là NOT NULL để ràng buộc với Khóa ghép
    FacultyID INT , 
    MajorID int, 
    
    Avatar NVARCHAR(255),
    
    -- Định nghĩa Khóa ngoại Student -> Faculty
    -- Khóa ngoại này chỉ kiểm tra FacultyID tồn tại trong Faculty
    FOREIGN KEY (FacultyID) REFERENCES Faculty(FacultyID),
    
    -- Định nghĩa Khóa ngoại Student -> Major
    -- Khóa ngoại phải khớp với tất cả các cột trong Khóa chính của Major (FacultyID, MajorID)
    -- LƯU Ý: Thứ tự cột trong REFERENCES phải khớp với Khóa chính của Major
    FOREIGN KEY (FacultyID, MajorID) REFERENCES Major(FacultyID, MajorID)
    -- (Trong trường hợp này, thứ tự trong bảng Student: FacultyID, MajorID; thứ tự Khóa chính của Major: FacultyID, MajorID. -> Đã khớp)
);
GO
-- Chèn dữ liệu vào bảng Faculty
INSERT INTO Faculty (FacultyID, FacultyName) VALUES
(1, N'Công nghệ thông tin'),
(2, N'Ngôn Ngữ Anh'),
(3, N'Quản Trị Kinh Doanh');
GO

-- Chèn dữ liệu vào bảng Major
INSERT INTO Major (FacultyID, MajorID, Name) VALUES
(1, 1, N'Công nghệ phần mềm'),
(2, 1, N'Tiếng Anh Thương Mại'),
(1, 2, N'Hệ thống thông tin'),
(2, 2, N'Tiếng Anh Truyền Thông'),
(1, 3, N'An toàn thông tin');
GO
